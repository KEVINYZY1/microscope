<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vipshop.microscope.report.repository.MsgReportRepository">
	
	<resultMap id="msgReportList" type="MsgReport">
		<result column="hour" property="hour" />
		<result column="msg_num" property="msgNum" />
		<result column="msg_size" property="msgSize" />
	</resultMap>
	
	<insert id="saveMsgReport" parameterType="MsgReport">
		insert into msg_report
		(year, month, week, day, hour, msg_num, msg_size)
		values
		(#{year},#{month},#{week},#{day},#{hour},#{msgNum},#{msgSize})
	</insert>
	
	<select id="findMsgReport" parameterType="MsgReportCondition" resultType="MsgReport">
		select SUM(msg_num) as msgNum, SUM(msg_size) as msgSize 
		from msg_report
		where 
		<if test="year != -1"> year = #{year} </if>
		<if test="month != -1"> and month = #{month} </if>
		<if test="week != -1"> and week = #{week} </if>
		<if test="day != -1"> and day = #{day} </if>
	</select>
	
	<select id="findMsgReportTrend" parameterType="MsgReportCondition" resultMap="msgReportList">
		select SUM(msg_num) as msgNum, SUM(msg_size) as msgSize, hour 
		from msg_report
		where 
		<if test="year != -1"> year = #{year} </if>
		<if test="month != -1"> and month = #{month} </if>
		<if test="week != -1"> and week = #{week} </if>
		<if test="day != -1"> and day = #{day} </if>
		
		group by hour
		order by hour
	</select>
	
	<delete id="empty">
		delete from msg_report;
	</delete>
	
	
</mapper>